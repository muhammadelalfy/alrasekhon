function m(e){return typeof e=="object"&&e!==null}function d(e,r){return e=m(e)?e:Object.create(null),new Proxy(e,{get(n,o,s){return Reflect.get(n,o,s)||Reflect.get(r,o,s)}})}function h(e){return e!==null&&typeof e=="object"}function y(e,r){const n=Array.isArray(e)&&Array.isArray(r),o=h(e)&&h(r);if(!n&&!o)throw new Error("Can only merge object with object or array with array");const s=n?[]:{};return[...Object.keys(e),...Object.keys(r)].forEach(t=>{Array.isArray(e[t])&&Array.isArray(r[t])?s[t]=[...Object.values(y(e[t],r[t]))]:r[t]!==null&&typeof r[t]=="object"&&typeof e[t]=="object"?s[t]=y(e[t],r[t]):e[t]!==void 0&&r[t]===void 0?s[t]=e[t]:e[t]===void 0&&r[t]!==void 0&&(s[t]=r[t])}),s}function b(e,r){return r.reduce((n,o)=>o==="[]"&&Array.isArray(n)?n:n==null?void 0:n[o],e)}function j(e,r,n){const o=r.slice(0,-1).reduce((s,i)=>/^(__proto__)$/.test(i)?{}:s[i]=s[i]||{},e);if(Array.isArray(o[r[r.length-1]])&&Array.isArray(n)){const s=o[r[r.length-1]].map((i,t)=>Array.isArray(i)&&typeof i!="object"?[...i,...n[t]]:typeof i=="object"&&i!==null&&Object.keys(i).some(c=>Array.isArray(i[c]))?y(i,n[t]):{...i,...n[t]});o[r[r.length-1]]=s}else r[r.length-1]===void 0&&Array.isArray(o)&&Array.isArray(n)?o.push(...n):o[r[r.length-1]]=n;return e}function O(e,r){return r.reduce((n,o)=>{const s=o.split(".");if(!s.includes("[]"))return j(n,s,b(e,s));const i=s.indexOf("[]"),t=s.slice(0,i),c=s.slice(0,i+1),l=s.slice(i+1),u=b(e,c),a=[];for(const f of u)l.length!==0&&(Array.isArray(f)||typeof f=="object")?a.push(O(f,[l.join(".")])):a.push(f);return j(n,t,a)},Array.isArray(e)?[]:{})}function p(e,r,n,o){try{const s=r==null?void 0:r.getItem(o);s&&e.$patch(n==null?void 0:n.deserialize(s))}catch{}}function _(e={}){return r=>{const{options:{persist:n},store:o}=r;if(!n)return;const s=(Array.isArray(n)?n.map(i=>d(i,e)):[d(n,e)]).map(({storage:i=localStorage,beforeRestore:t=null,afterRestore:c=null,serializer:l={serialize:JSON.stringify,deserialize:JSON.parse},key:u=o.$id,paths:a=null})=>({storage:i,beforeRestore:t,afterRestore:c,serializer:l,key:u,paths:a}));s.forEach(i=>{const{storage:t,serializer:c,key:l,paths:u,beforeRestore:a,afterRestore:f}=i;a==null||a(r),p(o,t,c,l),f==null||f(r),o.$subscribe((S,A)=>{try{const g=Array.isArray(u)?O(A,u):A;t.setItem(l,c.serialize(g))}catch{}},{detached:!0})}),o.$hydrate=({runHooks:i=!0}={})=>{s.forEach(t=>{const{beforeRestore:c,afterRestore:l,storage:u,serializer:a,key:f}=t;i&&(c==null||c(r)),p(o,u,a,f),i&&(l==null||l(r))})}}}var z=_();export{z as s};
